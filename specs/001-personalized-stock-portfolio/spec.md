# Feature Specification: Personalized Stock Portfolio App

**Feature Branch**: `001-personalized-stock-portfolio`  
**Created**: 2025-10-21  
**Status**: Draft  
**Input**: User description: "나의 관심 주식을 모아 주는 주식 앱을 만들어줘"

## Clarifications

### Session 2025-10-21

- Q: 앱이 지원할 주식 시장 범위는? → A: 한국 + 미국 주식 시장 모두 (KOSPI/KOSDAQ + NYSE/NASDAQ)
- Q: 사용자 인증 방식은? → A: 이메일/비밀번호 인증만
- Q: 일 단위 캔들 차트가 표시할 기간 범위는? → A: 사용자가 탭으로 기간 선택 가능 (30m-2d, 1h-1wk, 1d-6m, 1wk-2y, 1mo-7y)
- Q: 사용자 데이터 보관 정책은? → A: 영구 보관 (사용자가 계정 삭제 요청 전까지)
- Q: 워치리스트의 최대 항목 수는? → A: 최대 50개로 제한
- Q: 사용자당 생성 가능한 포트폴리오 수는? → A: 최대 3개 (미리 정의된 이름: "장기투자", "단기투자", "정찰병")
- Q: 보유 종목 추가 시 평균 단가와 수량은 필수 입력인가? → A: 네, 필수 입력

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Create and Manage Watchlist (Priority: P1)

사용자는 자주 확인하는 주식 종목들을 워치리스트에 추가하여 한 곳에서 빠르게 볼 수 있습니다. 심볼(티커) 검색을 통해 종목을 찾고, 워치리스트에 추가하거나 삭제할 수 있으며, 각 종목의 현재가와 변동률을 카드 형태로 확인할 수 있습니다.

**Why this priority**: 워치리스트는 사용자가 관심 있는 종목을 빠르게 모니터링하는 핵심 기능으로, 앱의 주요 가치를 제공하는 MVP의 중심입니다.

**Independent Test**: 사용자가 심볼을 검색하고 워치리스트에 추가한 후, 추가된 종목의 현재가와 변동률이 3초 이내에 화면에 표시되는지 확인하면 독립적으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 사용자가 로그인한 상태에서, **When** 검색창에 주식 심볼(예: "AAPL")을 입력하면, **Then** 해당 종목이 검색 결과에 표시됨
2. **Given** 검색 결과에서 종목을 선택했을 때, **When** "워치리스트에 추가" 버튼을 클릭하면, **Then** 종목이 워치리스트에 추가되고 3초 이내에 현재가와 변동률이 표시됨
3. **Given** 워치리스트에 종목이 있을 때, **When** 삭제 버튼을 클릭하면, **Then** 해당 종목이 워치리스트에서 즉시 제거됨
4. **Given** 워치리스트에 여러 종목이 있을 때, **When** 사용자가 드래그 앤 드롭으로 순서를 변경하면, **Then** 변경된 순서가 유지됨
5. **Given** 워치리스트가 비어있을 때, **When** 사용자가 워치리스트 화면을 보면, **Then** "종목을 추가하세요" 안내 메시지가 표시됨

---

### User Story 2 - View Stock Price Details (Priority: P1)

사용자는 워치리스트에서 종목을 선택하여 상세 화면으로 이동할 수 있으며, 현재가, 일 변동률, 거래량, 장 상태(장중/마감)를 확인할 수 있습니다. 캔들스틱 차트로 가격 추이를 시각적으로 파악할 수 있으며, 탭을 통해 5가지 기간 옵션(30분-2일, 1시간-1주, 1일-6개월, 1주-2년, 1개월-7년)을 선택할 수 있습니다.

**Why this priority**: 워치리스트와 함께 사용자가 종목의 핵심 정보를 빠르게 확인하는 필수 기능으로, P1 우선순위의 워치리스트 기능을 보완합니다.

**Independent Test**: 사용자가 워치리스트에서 종목을 선택하면 1초 이내에 상세 화면이 로드되고, 현재가/변동률/거래량/장상태가 표시되며, 기본 차트가 렌더링되는지 확인하면 독립적으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 워치리스트에 종목이 있을 때, **When** 종목 카드를 클릭하면, **Then** 1초 이내에 상세 화면이 표시됨
2. **Given** 상세 화면이 로드되었을 때, **When** 화면을 확인하면, **Then** 현재가, 일 변동률, 거래량, 장 상태가 명확히 표시됨
3. **Given** 상세 화면에서, **When** 스크롤하면, **Then** 캔들스틱 차트가 기본 기간(1일-6개월)으로 표시됨
4. **Given** 차트가 표시될 때, **When** 기간 탭(30분-2일, 1시간-1주, 1일-6개월, 1주-2년, 1개월-7년)을 클릭하면, **Then** 해당 기간의 차트 데이터로 업데이트됨
5. **Given** 장이 마감된 종목일 때, **When** 상세 화면을 보면, **Then** 장 상태가 "마감"으로 표시되고 마지막 거래가가 보임
6. **Given** 장중인 종목일 때, **When** 상세 화면을 보면, **Then** 장 상태가 "장중"으로 표시되고 현재가가 보임

---

### User Story 3 - Manage Portfolio Holdings (Priority: P2)

### 기능 설명

사용자는 미리 정의된 3개의 포트폴리오("장기투자", "단기투자", "정찰병") 중 하나를 선택하고, 보유 중인 종목의 심볼, 수량, 평균 단가를 추가/수정/삭제할 수 있습니다. 포트폴리오 화면에서 총 평가액, 손익, 수익률을 집계하여 한눈에 확인할 수 있습니다.

### Acceptance Criteria

**Why this priority**: 워치리스트와 시세 조회가 작동하는 MVP 이후, 사용자가 실제 보유 종목을 관리하고 손익을 추적하는 부가 가치 기능입니다.

**Independent Test**: 사용자가 포트폴리오를 선택하고 종목 1개를 추가한 후, 2분 이내에 총 평가액과 수익률이 계산되어 표시되는지 확인하면 독립적으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 로그인한 사용자가 포트폴리오 화면에 접근했을 때, **When** 화면을 확인하면, **Then** "장기투자", "단기투자", "정찰병" 3개의 포트폴리오 탭이 표시됨
2. **Given** 포트폴리오 탭을 선택했을 때, **When** "종목 추가" 버튼을 클릭하고 심볼, 수량, 평균 단가를 입력하면, **Then** 종목이 해당 포트폴리오에 추가됨
3. **Given** 포트폴리오에 종목이 추가되었을 때, **When** 포트폴리오 화면을 확인하면, **Then** 총 평가액, 손익, 수익률이 2분 이내에 계산되어 표시됨
4. **Given** 포트폴리오에 종목이 있을 때, **When** 종목을 선택하고 수정 버튼을 클릭하면, **Then** 수량이나 평균 단가를 변경할 수 있음
5. **Given** 포트폴리오에 종목이 있을 때, **When** 종목을 삭제하면, **Then** 즉시 해당 포트폴리오에서 제거되고 집계 정보가 업데이트됨
6. **Given** 3개의 포트폴리오가 있을 때, **When** 사용자가 포트폴리오 탭 간 전환하면, **Then** 각 포트폴리오의 독립적인 종목 목록과 집계가 표시됨

---

### User Story 4 - User Authentication and Personalization (Priority: P1)

사용자는 계정을 생성하거나 로그인하여 개인화된 워치리스트, 포트폴리오, 뉴스 정보를 저장하고 다른 기기에서도 동일한 정보를 확인할 수 있습니다.

**Why this priority**: 개인화된 데이터 저장은 모든 기능의 전제 조건으로, 사용자별 데이터 격리와 지속성을 보장하는 필수 기능입니다.

**Independent Test**: 사용자가 계정을 생성하고 로그인한 후, 워치리스트에 종목을 추가하고 로그아웃 후 다시 로그인했을 때 동일한 워치리스트가 표시되는지 확인하면 독립적으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 새 사용자가 앱에 접속했을 때, **When** "회원가입" 버튼을 클릭하고 필요한 정보를 입력하면, **Then** 계정이 생성되고 자동으로 로그인됨
2. **Given** 계정이 있는 사용자가, **When** 이메일과 비밀번호를 입력하여 로그인하면, **Then** 개인화된 워치리스트와 포트폴리오가 로드됨
3. **Given** 로그인한 상태에서 워치리스트를 수정했을 때, **When** 로그아웃 후 다시 로그인하면, **Then** 수정된 워치리스트가 그대로 유지됨
4. **Given** 로그인한 사용자가, **When** 다른 기기에서 동일한 계정으로 로그인하면, **Then** 모든 워치리스트와 포트폴리오 데이터가 동기화됨
5. **Given** 비로그인 상태일 때, **When** 워치리스트나 포트폴리오 기능에 접근하면, **Then** 로그인 화면으로 리디렉션됨

---

### Edge Cases

- 사용자가 존재하지 않는 심볼을 검색했을 때 어떻게 처리할까? → "검색 결과가 없습니다" 메시지 표시
- 외부 API가 응답하지 않거나 타임아웃이 발생했을 때 어떻게 처리할까? → 캐시된 데이터 표시 또는 "일시적으로 데이터를 불러올 수 없습니다" 오류 메시지 표시
- 워치리스트나 포트폴리오에 추가할 수 있는 종목 수에 제한이 있을까? → 기본값: 워치리스트 50개, 포트폴리오 종목 100개까지 허용
- 포트폴리오에서 수량을 0 이하로 입력하거나 음수 평균 단가를 입력하면 어떻게 될까? → 유효성 검증 후 "올바른 값을 입력하세요" 오류 메시지 표시
- 장이 마감된 시간에 시세를 조회하면 어떤 데이터가 표시될까? → 마지막 거래가와 "마감" 상태 표시
- 5분 캐시 기간 동안 동일한 종목을 여러 사용자가 조회하면? → 캐시된 데이터를 재사용하여 외부 API 호출 최소화
- 포트폴리오 종목의 현재가를 가져올 수 없을 때 손익 계산은? → 마지막으로 알려진 가격 또는 "N/A" 표시

---

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 사용자 계정을 생성하고 이메일 주소와 비밀번호로 인증할 수 있어야 함 (소셜 로그인 미지원, 이메일/비밀번호 방식만 사용)
- **FR-002**: 시스템은 각 사용자의 워치리스트, 포트폴리오, 설정을 독립적으로 저장하고 관리해야 함
- **FR-003**: 사용자는 주식 심볼(티커)을 검색하여 워치리스트에 추가하거나 삭제할 수 있어야 함 (한국 시장: KOSPI/KOSDAQ, 미국 시장: NYSE/NASDAQ 지원)
- **FR-004**: 워치리스트에 추가된 종목은 현재가와 일 변동률을 카드 형태로 표시해야 하며, 3초 이내에 로드되어야 함
- **FR-005**: 사용자는 워치리스트 내 종목의 순서를 변경하거나 그룹으로 조직할 수 있어야 함
- **FR-006**: 사용자는 워치리스트에서 종목을 선택하여 상세 화면에서 현재가, 일 변동률, 거래량, 장 상태(장중/마감)를 확인할 수 있어야 함
- **FR-007**: 상세 화면은 캔들스틱 차트를 제공하여 가격 추이를 시각화해야 하며, 사용자가 탭으로 기간을 선택할 수 있어야 함 (30분-2일, 1시간-1주, 1일-6개월, 1주-2년, 1개월-7년)
- **FR-008**: 시세 조회의 95%는 1초 이내에 결과를 표시해야 함 (체감 기준)
- **FR-009**: 사용자는 미리 정의된 3개의 포트폴리오("장기투자", "단기투자", "정찰병") 중 하나를 선택할 수 있어야 함
- **FR-010**: 사용자는 포트폴리오에 종목(심볼, 수량, 평균 단가)을 추가, 수정, 삭제할 수 있어야 함
- **FR-011**: 포트폴리오는 총 평가액, 손익, 수익률을 자동으로 집계하여 표시해야 함
- **FR-012**: 포트폴리오 선택부터 종목 1개 추가/삭제까지 2분 이내에 완료할 수 있어야 함
- **FR-013**: 시스템은 외부 주식 API를 통해 주식 데이터를 수집해야 함 (한국: KOSPI/KOSDAQ, 미국: NYSE/NASDAQ 시장 지원)
- **FR-014**: 시스템은 동일한 티커에 대한 외부 API 호출을 최소화하기 위해 5분간 데이터를 캐싱해야 함
- **FR-015**: 5분 이내에 동일한 티커를 조회할 경우 캐시된 데이터를 사용하고, 그렇지 않을 경우 외부 API를 호출해야 함
- **FR-016**: 시스템은 외부 API 호출 실패 시 캐시된 데이터를 우선 제공하고, 사용 가능한 캐시가 없을 경우 사용자에게 오류 메시지를 표시해야 함
- **FR-017**: 시스템은 사용자가 로그아웃 후 다시 로그인했을 때 모든 개인화된 데이터(워치리스트, 포트폴리오)를 복원해야 함
- **FR-018**: 시스템은 사용자 입력 검증을 수행하여 잘못된 심볼, 음수 수량, 음수 평균 단가 등을 거부하고 명확한 오류 메시지를 표시해야 함
- **FR-019**: 시스템은 사용자 데이터를 영구적으로 보관하며, 사용자가 계정 삭제를 명시적으로 요청할 때만 데이터를 삭제해야 함

### Key Entities

- **User**: 앱을 사용하는 개인, 이메일, 비밀번호, 생성일, 마지막 로그인 시간 등을 포함
- **Watchlist**: 사용자가 관리하는 관심 종목 목록, 사용자 ID, 종목 심볼 리스트, 순서 정보 포함
- **WatchlistItem**: 워치리스트 내 개별 종목, 심볼, 추가된 날짜, 사용자 정의 메모(선택 사항) 포함
- **Portfolio**: 사용자가 선택하는 포트폴리오, 미리 정의된 이름("장기투자", "단기투자", "정찰병"), 생성일, 사용자 ID 포함. 사용자당 최대 3개
- **Holding**: 포트폴리오 내 보유 종목, 심볼, 수량, 평균 단가, 추가된 날짜 포함
- **StockQuote**: 주식 시세 정보, 심볼, 현재가, 일 변동률, 거래량, 장 상태, 마지막 업데이트 시간 포함 (캐싱 목적)
- **CandlestickData**: 캔들스틱 차트 데이터, 심볼, 날짜/시간, 시가(Open), 고가(High), 저가(Low), 종가(Close), 조정 종가(Adj Close), 거래량(Volume) 포함. 5가지 기간 옵션 지원: 30분 간격-2일, 1시간 간격-1주, 1일 간격-6개월, 1주 간격-2년, 1개월 간격-7년

---

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자가 워치리스트에 종목을 추가한 후 3초 이내에 현재가와 변동률이 카드에 표시됨
- **SC-002**: 시세 조회의 95%가 1초 이내에 결과를 표시함 (체감 기준)
- **SC-003**: 사용자가 포트폴리오를 선택하고 종목 1개를 추가하거나 삭제하는 데 2분 이내에 완료함
- **SC-004**: 동일한 티커에 대해 5분 이내 재조회 시 외부 API 호출 없이 캐시된 데이터를 사용하여 응답 시간을 50% 이상 단축함
- **SC-005**: 사용자가 계정 생성부터 첫 번째 워치리스트 종목 추가까지 3분 이내에 완료함
- **SC-006**: 로그인한 사용자가 다른 기기에서 접속했을 때 모든 워치리스트와 포트폴리오 데이터가 동기화되어 표시됨
- **SC-007**: 외부 API 장애 시 캐시된 데이터를 사용하여 80% 이상의 조회 요청을 처리함
- **SC-008**: 사용자가 포트폴리오에서 손익과 수익률을 확인하는 데 평균 10초 이내 소요됨
- **SC-009**: 90% 이상의 사용자가 첫 사용 시 안내 없이 워치리스트에 종목을 추가하는 작업을 완료함 (직관적 UI)

